# 성적 데이터 처리 가이드 (현재 상태)

본 문서는 브라우저 도구(`gradebook_cleaner_browser.html`)의 현 상태 및 두 가지 입력 양식 처리 규칙, 통합/정렬/제외 규칙을 정리합니다.

## 지원 입력 양식
- 교과학습발달상황 (Xlsx DATA양식)
  - 라벨: "교과학습발달상황(Xlsx DATA양식) 업로드"
  - 업로드 즉시 정리 및 미리보기 표시
- 학생편성현황
  - 라벨: "학생편성현황 업로드"
  - 업로드 즉시 정리 및 미리보기 표시

두 양식 중 하나만 업로드해도 동작하며, 둘 다 업로드된 경우 결과를 자동 병합해 미리보기/다운로드에 반영합니다.

## 출력 스키마 (고정)
- 학년, 반, 번호, 이름, 과목학년, 과목학기, 교과, 과목명, 학점

## 공통 동작
- 미리보기: 항상 300행 고정
- 다운로드:
  - CSV: 현재 결과 그대로
  - XLSX: 학년 → 반 → 번호 오름차순으로 자동 정렬 후 저장
- 버튼: "정리해서 미리보기", "CSV 다운로드", "XLSX 다운로드"
  - 교과학습발달상황은 업로드 즉시 정리되므로 별도 클릭 없이 미리보기 표시됨
  - 다운로드 시 두 양식 데이터가 있으면 자동 통합 데이터 사용

## 교과학습발달상황 처리 규칙
- 시트: 항상 첫 번째 시트 사용 (시트 선택 UI 삭제)
- 학년/반 추출:
  - A3 우선, 없으면 상단 8행 × A–E에서 "학"/"반" 포함 텍스트 탐색
  - 전각 숫자/한글 숫자/하이픈(1-2)/슬래시(1/2) 등 다양한 표기 인식
- 헤더 자동 탐지:
  - 상단 20행에서 [번호, 성명, 학년, 학기, 과목, 교과] 중 2개 이상 포함된 행을 헤더로 채택
- 전처리/보강:
  - 번호/성명(→이름)/학년/학기/반은 forward-fill
  - 숫자 변환 시 빈 문자열은 null 처리 (반=0 현상 방지)
  - 교과 키: 교과/교과명/교과군 중 존재하는 값 사용
- 유효 행 필터: 과목(과목명)이 비어있지 않은 행만 사용
- 출력 매핑:
  - 학년/반: A3(또는 상단 스캔) 값
  - 번호: A열(번호)
  - 이름: B열(성명/이름)
  - 과목학년: C열(학년)
  - 과목학기: D열(학기)
  - 교과: E열(교과)
  - 과목명: F열(과목)
  - 학점: G열(학점), 없을 시 학점수 사용

## 학생편성현황 처리 규칙
- 데이터 시작: 3행부터(1–2행은 헤더)
- 열 매핑:
  - B: 과목학기 → 첫 숫자 추출
  - C: 과목학년 → 첫 숫자 추출
  - D: 교과 → 문자열
  - E: 과목명(학점) → 마지막 괄호 속 숫자를 학점으로 분리, 괄호 앞은 과목명
  - G: 학년 → "n학년"에서 n만 추출
  - H: 반 → 정확히 "n반" 형태와 전체 일치하는 경우만 채택(예: "1반", "1 반")
    - 예외: "심화수학1반(…)" 등은 무시(해당 행 스킵)
  - I: 번호 → 숫자 변환
  - J: 이름 → 문자열
- 제외 규칙:
  - 이름에 괄호가 포함된 경우(전각/반각) 해당 행 스킵: 예) "(미재학)홍길동", "홍길동(전학)"
- 출력 스키마: 상동(학년, 반, 번호, 이름, 과목학년, 과목학기, 교과, 과목명, 학점)

## 파일 경로
- 브라우저 도구: `gradebook_cleaner_browser.html`
- 문서: `docs/processing_guide.md` (본 파일), `docs/extraction.md`(초기 스키마 설명)

## 참고/한계
- 시트 상단에 학년/반 표기가 전혀 없으면 교과학습발달상황에서 학년/반이 비어 있을 수 있음
- CSV 다운로드는 정렬을 적용하지 않습니다(요청 시 적용 가능)
- 추가 양식은 안전을 위해 기존 로직에 영향 없이 별도 규칙으로 확장 예정
